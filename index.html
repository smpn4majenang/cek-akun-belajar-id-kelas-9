<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cek Akun Belajar Siswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .video-container {
            position: relative;
            padding-bottom: 177.77%; /* Aspect ratio untuk shorts (9:16) */
            height: 0;
            overflow: hidden;
            border-radius: 1rem;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-indigo-700 min-h-screen flex items-center justify-center p-4">

    <!-- Login Container -->
    <div id="login-container" class="w-full max-w-md glass-card rounded-3xl shadow-2xl p-8 transform transition-all duration-500">
        <div class="text-center mb-8">
            <div class="bg-blue-600 w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg rotate-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8-0v4h8z" />
                </svg>
            </div>
            <h1 class="text-2xl font-bold text-slate-800">Cek Akun Belajar.id</h1>
            <p class="text-slate-500 mt-2">Silakan masukkan NIS Anda untuk masuk</p>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2 text-center">Password</label>
                <input type="password" id="nis-input" placeholder="Masukkan NIS" class="w-full px-5 py-4 bg-slate-100 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 transition-all outline-none text-sm tracking-widest text-center">
            </div>
            <button id="login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-2xl shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2">
                <span>Masuk Sekarang</span>
            </button>
        </div>
        <p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden font-medium"></p>
        <div id="initial-loading" class="mt-4 hidden text-center">
            <div class="inline-block animate-spin rounded-full h-5 w-5 border-2 border-blue-600 border-t-transparent"></div>
            <p class="text-xs text-slate-400 mt-2">Menghubungkan ke database...</p>
        </div>
    </div>

    <!-- Data Container -->
    <div id="data-container" class="w-full max-w-2xl hidden">
        <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-blue-600 p-6 text-white flex justify-between items-center">
                <div>
                    <h2 class="text-lg font-bold">Informasi Akun</h2>
                    <p class="text-blue-100 text-xs opacity-80">Data ditemukan di sistem</p>
                </div>
                <button id="logout-btn" class="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            
            <div class="p-6 md:p-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Left Side: Data -->
                    <div class="space-y-6">
                        <div class="flex items-center gap-4 pb-6 border-b border-slate-100">
                            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold text-2xl flex-shrink-0" id="initials">
                                S
                            </div>
                            <div>
                                <h3 id="display-nama" class="text-xl font-bold text-slate-800 leading-tight">Nama Siswa</h3>
                                <p id="display-kelas" class="text-slate-500 font-medium">Kelas XX</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-slate-50 p-4 rounded-2xl">
                                <p class="text-xs text-slate-400 font-semibold uppercase tracking-wider mb-1">NIS Siswa</p>
                                <p id="display-nis" class="text-slate-700 font-bold">12345678</p>
                            </div>

                            <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                                <p class="text-xs text-blue-400 font-semibold uppercase tracking-wider mb-1">Akun Belajar.id</p>
                                <p id="display-akun" class="text-blue-700 font-bold break-all">siswa@belajar.id</p>
                                <button onclick="copyText('display-akun')" class="mt-2 text-[10px] bg-blue-600 text-white px-2 py-1 rounded uppercase font-bold">Salin</button>
                            </div>

                            <div class="bg-indigo-50 p-4 rounded-2xl border border-indigo-100">
                                <p class="text-xs text-indigo-400 font-semibold uppercase tracking-wider mb-1">Password</p>
                                <div class="flex justify-between items-center">
                                    <p id="display-password" class="text-indigo-700 font-bold">********</p>
                                    <button id="toggle-pwd" class="text-indigo-400 hover:text-indigo-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <div class="bg-slate-50 p-4 rounded-2xl">
                                <p class="text-xs text-slate-400 font-semibold uppercase tracking-wider mb-1">Status</p>
                                <span id="display-status" class="inline-block px-3 py-1 rounded-full text-xs font-bold mt-1">Status</span>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Tutorial (Conditional) -->
                    <div id="tutorial-section" class="hidden space-y-4">
                        <div class="flex items-center gap-2 text-amber-600 mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                            </svg>
                            <h4 class="font-bold text-sm uppercase">Panduan Aktivasi</h4>
                        </div>
                        <p class="text-xs text-slate-500 leading-relaxed mb-4">Akun Anda belum aktif. Ikuti salah satu panduan video di bawah ini:</p>
                        
                        <div class="space-y-4 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                            <!-- Video 1 -->
                            <div class="video-container shadow-md">
                                <iframe src="https://www.youtube.com/embed/Mfd1NXRjWAg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <!-- Video 2 -->
                            <div class="video-container shadow-md">
                                <iframe src="https://www.youtube.com/embed/1s0MsBVajMo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                            <!-- Video 3 -->
                            <div class="video-container shadow-md">
                                <iframe src="https://www.youtube.com/embed/RopJOoSQxpg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <p class="text-center text-white/60 text-[10px] mt-6">© <span id="current-year"></span> Aplikasi Cek Akun Belajar.id</p>
    </div>

    <script>
        const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRXKCAC17E7PvDxgs1JuhbwUqFzz_UXn98W_jcESrNpL3DSDLt9cyn4HAiPWPE5UEpFwbMIbQQxTBHb/pub?output=csv";
        
        const loginContainer = document.getElementById('login-container');
        const dataContainer = document.getElementById('data-container');
        const nisInput = document.getElementById('nis-input');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');
        const loading = document.getElementById('initial-loading');
        
        let allSiswa = [];
        let currentSiswa = null;
        let pwdVisible = false;

        document.getElementById('current-year').textContent = new Date().getFullYear();

        window.onload = async () => {
            loading.classList.remove('hidden');
            try {
                const response = await fetch(DATA_URL);
                const csvData = await response.text();
                Papa.parse(csvData, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        allSiswa = results.data;
                        loading.classList.add('hidden');
                    }
                });
            } catch (error) {
                showError("Gagal terhubung ke database. Cek koneksi internet.");
            }
        };

        function showError(msg) {
            loginError.innerText = msg;
            loginError.classList.remove('hidden');
            setTimeout(() => loginError.classList.add('hidden'), 3000);
        }

        function getValue(row, keywords) {
            const keys = Object.keys(row);
            for (let k of keys) {
                const lowKey = k.toLowerCase();
                if (keywords.some(kw => lowKey.includes(kw.toLowerCase()))) return row[k];
            }
            return "";
        }

        loginBtn.addEventListener('click', () => {
            const inputNIS = nisInput.value.trim();
            if (!inputNIS) {
                showError("Harap masukkan NIS!");
                return;
            }

            currentSiswa = allSiswa.find(s => {
                const nisValue = getValue(s, ["nis", "induk"]).toString().trim();
                return nisValue === inputNIS;
            });

            if (currentSiswa) {
                showData();
            } else {
                showError("NIS tidak ditemukan!");
            }
        });

        function showData() {
            const nama = getValue(currentSiswa, ["nama", "name"]);
            const kelas = getValue(currentSiswa, ["kelas", "class", "rombel"]);
            const nis = getValue(currentSiswa, ["nis", "induk"]);
            const akun = getValue(currentSiswa, ["belajar", "id", "email"]);
            const pwd = getValue(currentSiswa, ["password", "sandi", "pwd"]);
            const statusRaw = getValue(currentSiswa, ["status", "keterangan"]) || "AKTIF";
            const status = statusRaw.toUpperCase();

            document.getElementById('display-nama').innerText = nama || "Tanpa Nama";
            document.getElementById('display-kelas').innerText = kelas || "-";
            document.getElementById('display-nis').innerText = nis || "-";
            document.getElementById('display-akun').innerText = akun || "-";
            document.getElementById('display-password').innerText = "••••••••";
            document.getElementById('display-status').innerText = status;
            document.getElementById('initials').innerText = (nama || "?").charAt(0).toUpperCase();

            const statusBadge = document.getElementById('display-status');
            const tutorialSection = document.getElementById('tutorial-section');

            // Cek jika status mengandung kata "BELUM" atau "TIDAK AKTIF"
            if (status.includes('BELUM') || status.includes('TIDAK AKTIF')) {
                statusBadge.className = "inline-block px-3 py-1 rounded-full text-xs font-bold mt-1 bg-red-100 text-red-600";
                tutorialSection.classList.remove('hidden');
            } else {
                statusBadge.className = "inline-block px-3 py-1 rounded-full text-xs font-bold mt-1 bg-green-100 text-green-600";
                tutorialSection.classList.add('hidden');
            }

            loginContainer.classList.add('hidden');
            dataContainer.classList.remove('hidden');
        }

        document.getElementById('logout-btn').addEventListener('click', () => {
            dataContainer.classList.add('hidden');
            loginContainer.classList.remove('hidden');
            nisInput.value = "";
            currentSiswa = null;
            pwdVisible = false;
        });

        document.getElementById('toggle-pwd').addEventListener('click', () => {
            const pwdDisplay = document.getElementById('display-password');
            const actualPwd = getValue(currentSiswa, ["password", "sandi", "pwd"]);
            pwdVisible = !pwdVisible;
            pwdDisplay.innerText = pwdVisible ? actualPwd : "••••••••";
        });

        function copyText(id) {
            const text = document.getElementById(id).innerText;
            const dummy = document.createElement("textarea");
            document.body.appendChild(dummy);
            dummy.value = text;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);
            const btn = event.target;
            const originalText = btn.innerText;
            btn.innerText = "BERHASIL!";
            setTimeout(() => btn.innerText = originalText, 2000);
        }

        nisInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginBtn.click();
        });
    </script>
</body>
</html>
